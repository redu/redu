<%#
  Barra lateral de ambientes.

  Variáveis:
    environment: o ambiente.
    management: se está sendo mostrada nas telas de gerenciamento (default false).
%>

<% management = false unless local_assigns.has_key? :management %>

<div class="entity-sidebar">
  <%= render "environments/sidebar_thumbnail", environment: environment,
    clickable: false %>

  <%# Gerenciamento. %>
  <% if management %>

    <%# Quantidade de membros e convidar. %>
    <div class="entity-sidebar-widget content-body">
      <div class="entity-sidebar-widget-section">
        <span class="entity-sidebar-widget-icon icon-environment-gray_16_18 show text-replacement">Ambiente</span>
        <%= content_tag :span, environment.name, class: "entity-sidebar-widget-name" %>
      </div>
      <hr class="entity-sidebar-widget-separator">
      <div class="entity-sidebar-widget-section">
        <span class="entity-sidebar-widget-legend icon-manager-gray_16_18-before">Admins.:</span>
        <%= environment.administrators.count %>
      </div>
      <hr class="entity-sidebar-widget-separator">
      <div class="entity-sidebar-widget-section">
        <span class="entity-sidebar-widget-legend icon-members-gray_16_18-before">Total de <br/>Membros:</span>
        <%= environment.users.count %>
      </div>
      <hr class="entity-sidebar-widget-separator">
      <div class="entity-sidebar-widget-section centralize">
        <%# TODO: Modal de convidar membros. %>
        <%= link_to "Convide Membros", "#", class: "link-secondary" %>
      </div>
    </div>

    <%# Licenças e faturas. %>
    <%= render "environments/admin/plans" %>

  <%# Normal. %>
  <% else %>

    <%# Breadcrumb de ícones. %>
    <%= render "bootstrap/breadcrumb_icons", current_entity: environment %>

    <%# Membros. %>
    <% cache ["environment_sidebar_connections_with_count", environment.id] do %>
      <div class="entity-members-counter-wrapper">
        <%= content_tag :span, environment.users.count,
          class: "entity-members-counter" %>
        <%= "membro".pluralize(environment.users.count) %>
      </div>

      <span class="entity-sidebar-separator icon-arrow-up-curly-gray show text-replacement">-</span>

      <ul class="entity-members-list clearfix">
        <%= render partial: "shared/item_linkable",
          collection: environment.users.limit(16),
          locals: { classes: "entity-member", size: 32, name: "display_name" } %>
      </ul>
    <% end %>
  <% end %>
</div>