<%= render :partial => 'shared/management_background' %>
<div class="management-sidebar">
  <%= render :partial => 'spaces/sidebar', :locals => { :space => @space } %>
</div>
<div class="main space grid_12 omega big-col">
  <%= render :partial => 'spaces/breadcrumbs',
    :locals => { :space => @space, :header_space => @header_space } %>

  <div id="space-manage" class="body management">
    <%= render :partial => 'spaces/admin/header',
      :locals => { :header_space => @header_space, :space => @space }%>
    <%= render :partial => 'spaces/admin/clean_header' %>

    <%= tabs :spaces_admin do %>
      <%= subtabs :spaces_admin do %>
        <% if @browser_not_supported %>
          <%= render :partial => 'spaces/admin/disclaimer_chart' %>
        <% elsif @space.students_id.empty? %>
          <div class="body">
            <div class="flash-message notice">
              <ul class="message icons-big-before icon-privacy-lightred_64_66-before">
                <li>O conteúdo desta página não está disponível para o curso que não possui alunos matriculados.</li>
                <li>Você pode <%= link_to "convidar pessoas a ser tornarem membros", admin_manage_invitations_environment_course_path(@course.environment, @course)%>.</li>
              <ul>
            </div>
          </div>
        <% else %>
          <h3 class="form-header graph-header">Qual o desempenho dos alunos?</h3>

          <%= lazy_load(:chart, :jammit => true) do %>
            var treemap = new StudentsTreemap();
            treemap.load({ form: $("#graph-form"),
            renderTo: "treemap-chart",
            url: "<%= api_space_users_path(@space.id, :oauth_token => @token, :role=>"member") %>"});
          <% end %>

          <%= form_tag api_vis_students_participation_path(@space.id), :method => :get,
            :remote => true, :class => "concave-form", :id => "graph-form" do %>
            <% @space.students_id.each do |id| %>
              <%= hidden_field_tag "users_id[]", id %>
            <% end %>

            <%= hidden_field_tag :space_id, @space.id %>

            <%= label_tag "date_start_fake", "Data inicial", :id => "form-problem" %>
            <%= field_set_tag nil, :class => "inline" do %>
              <%= date_select "date_start_fake", nil,
                :default => Date.today - 9 %>
              <%= text_field_tag :date_start, nil,
                :style => "display: none;" %>
            <% end %>

            <%= label_tag "date_end_fake", "Data final" %>
            <%= field_set_tag nil, :id => "date-validate",
              :class => "inline" do %>
              <%= date_select "date_end_fake", nil, :end_year => Date.today.year %>
              <%= text_field_tag :date_end, nil, :style => "display: none;" %>
            <% end %>

            <%= hidden_field_tag :oauth_token, @token %>
            <%= submit_tag "Atualizar", :class=>"concave-submit" %>
          <% end %>
        <% end %>
      <% end %>
    <% end %>
  </div>
</div>
